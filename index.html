<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVå¥³å„ªæ¤œç´¢ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï½œAPIè‡ªå‹•ç”»åƒå–å¾—ç‰ˆ</title>
    <style>
        :root {
            --primary: #ff4081;
            --primary-dark: #c60055;
            --secondary: #f5f5f5;
            --text-main: #333;
            --text-light: #777;
            --bg-body: #f0f2f5;
            --card-radius: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; padding: 20px; text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        header h1 { margin: 0; font-size: 1.5rem; }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        /* æ¤œç´¢ãƒ‘ãƒãƒ« */
        .search-panel {
            background: white; padding: 20px; border-radius: var(--card-radius);
            box-shadow: var(--shadow); margin-bottom: 20px;
        }

        .search-header {
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; font-weight: bold; color: var(--primary);
        }

        .search-body {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-top: 15px;
        }

        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 0.85rem; color: var(--text-light); margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], select {
            padding: 10px; border: 1px solid #ddd; border-radius: 6px;
            font-size: 1rem; width: 100%; box-sizing: border-box;
        }

        .range-group { display: flex; align-items: center; gap: 5px; }

        .genre-group {
            grid-column: 1 / -1; display: flex; flex-wrap: wrap; gap: 10px;
            padding-top: 10px; border-top: 1px solid #eee;
        }

        .checkbox-label {
            display: flex; align-items: center; gap: 5px; font-size: 0.9rem;
            cursor: pointer; background: #f9f9f9; padding: 5px 10px;
            border-radius: 20px; border: 1px solid #eee; transition: all 0.2s;
        }

        .checkbox-label:hover { background: #ffebf0; border-color: var(--primary); }

        /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .control-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .result-count { font-weight: bold; color: var(--text-light); }
        .result-count span { color: var(--primary); font-size: 1.2rem; margin: 0 5px; }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }

        .card {
            background: white; border-radius: var(--card-radius); box-shadow: var(--shadow);
            overflow: hidden; transition: transform 0.2s; position: relative;
            display: flex; flex-direction: column; text-decoration: none; color: inherit;
        }

        .card:hover { transform: translateY(-5px); }
        .card-image-wrapper { position: relative; padding-top: 125%; background: #eee; }
        .card-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        
        .cup-badge {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7);
            color: #fff; width: 38px; height: 38px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; border: 2px solid var(--primary); z-index: 2;
        }

        .card-content { padding: 15px; flex-grow: 1; }
        .card-title { margin: 0 0 5px 0; font-size: 1.1rem; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.8rem; background: #f8f8f8; padding: 8px; border-radius: 6px; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 10px; }
        .tag { font-size: 0.65rem; padding: 2px 6px; background: #ffeef4; color: var(--primary); border-radius: 4px; }

        .btn-link {
            display: block; margin: 10px 15px 15px; background: var(--primary); color: white;
            text-align: center; padding: 10px; text-decoration: none; border-radius: 6px; font-weight: bold;
        }

        /* è©³ç´°ãƒšãƒ¼ã‚¸ */
        .detail-view { background: white; padding: 30px; border-radius: var(--card-radius); box-shadow: var(--shadow); max-width: 800px; margin: 0 auto; }
        .detail-flex { display: flex; flex-wrap: wrap; gap: 30px; }
        .detail-img img { width: 100%; max-width: 350px; border-radius: 8px; }
        .detail-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .detail-table th { text-align: left; color: var(--text-light); border-bottom: 1px solid #eee; padding: 10px 0; }
        .detail-table td { padding: 10px 0; border-bottom: 1px solid #eee; }
        .back-btn { display: inline-block; margin-bottom: 20px; color: var(--primary); text-decoration: none; font-weight: bold; }

        footer { text-align: center; padding: 30px; color: #888; font-size: 0.8rem; border-top: 1px solid #ddd; margin-top: 40px; }
    </style>
</head>
<body>

<header>
    <h1>AVå¥³å„ª æ¤œç´¢DB</h1>
</header>

<div class="container" id="mainContainer">
    <div class="search-panel">
        <div class="search-header" onclick="toggleSearch()">
            <span>ğŸ” çµã‚Šè¾¼ã¿æ¤œç´¢æ¡ä»¶</span>
            <span style="font-size:0.8rem; font-weight:normal; color:#888;">é–‹é–‰ã™ã‚‹</span>
        </div>
        <div class="search-body" id="searchBody">
            <div class="form-group"><label>åå‰</label><input type="text" id="filterName" placeholder="åå‰ã‚’å…¥åŠ›"></div>
            <div class="form-group">
                <label>å¹´é½¢</label>
                <div class="range-group">
                    <input type="number" id="filterAgeMin" placeholder="Min"><span>ã€œ</span><input type="number" id="filterAgeMax" placeholder="Max">
                </div>
            </div>
            <div class="form-group">
                <label>ã‚«ãƒƒãƒ—</label>
                <select id="filterCup">
                    <option value="">æŒ‡å®šãªã—</option>
                    <option value="A">A</option><option value="B">B</option><option value="C">C</option>
                    <option value="D">D</option><option value="E">E</option><option value="F">F</option>
                    <option value="G">G</option><option value="H">H</option><option value="I">I</option>
                    <option value="J">Jä»¥ä¸Š</option>
                </select>
            </div>
            <div class="genre-group" id="genreContainer"></div>
            <div style="grid-column: 1 / -1; text-align: right;">
                <button onclick="resetFilters()" style="padding: 8px 16px; cursor:pointer;">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
    </div>

    <div class="control-bar">
        <div class="result-count">è©²å½“: <span id="countDisplay">0</span>ä»¶</div>
        <select id="sortSelect">
            <option value="default">æ¨™æº–é †</option>
            <option value="age_asc">å¹´é½¢ãŒè‹¥ã„é †</option>
            <option value="bust_desc">ãƒã‚¹ãƒˆé †</option>
        </select>
    </div>

    <div class="results-grid" id="resultsContainer"></div>
</div>

<footer>
    Powered by <a href="https://affiliate.dmm.com/api/" target="_blank">DMM Webã‚µãƒ¼ãƒ“ã‚¹</a>
</footer>

<script>
    const API_ID = "Qr42BeY54EnU1EpnVWwb";
    const AFF_ID = "eastjam-990";

    const imageCache = {};

    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    const actressData = [
        { id: 10, name: "æ²³åŒ— å½©ä¼½", age: 26, cup: "E", bust: 88, waist: 57, hip: 86, height: 169, genre: ["äººæ°—", "ç¾å°‘å¥³", "ãƒ¢ãƒ‡ãƒ«"] },
        { id: 11, name: "å®‰éƒ¨ æœªè¯å­", age: 35, cup: "C", bust: 84, waist: 58, hip: 85, height: 154, genre: ["ç†Ÿå¥³", "ç¾è‚Œ"] },
        { id: 12, name: "ä¸‰ä¸Š æ‚ äºœ", age: 30, cup: "F", bust: 84, waist: 58, hip: 88, height: 159, genre: ["äººæ°—", "ã‚¢ã‚¤ãƒ‰ãƒ«"] }
    ];

    // ==========================================
    // APIã‹ã‚‰ç”»åƒã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°ï¼ˆä¿®æ­£æ¸ˆï¼‰
    // ==========================================
    async function fetchActressImage(actressName, imgElement, linkContainerElement = null) {
        if (imageCache[actressName]) {
            imgElement.src = imageCache[actressName];
            return;
        }

        try {
            const searchKeyword = actressName.replace(/\s+/g, "");
            const dmmApiUrl = `https://api.dmm.com/affiliate/v3/ActressSearch?api_id=${API_ID}&affiliate_id=${AFF_ID}&keyword=${encodeURIComponent(searchKeyword)}&output=json`;
            
            // alloriginsãƒ—ãƒ­ã‚­ã‚·ã‚’ä½¿ç”¨ï¼ˆæœ€ã‚‚å®‰å®šï¼‰
            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(dmmApiUrl)}`;

            const response = await fetch(proxyUrl);
            const wrapper = await response.json();
            const data = JSON.parse(wrapper.contents); // contentsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’JSONã¨ã—ã¦è§£æ

            if (data?.result?.actress?.length > 0) {
                const info = data.result.actress[0];
                const rawUrl = info.imageURL?.large;
                
                if (rawUrl) {
                    const secureUrl = rawUrl.replace("http://", "https://");
                    imageCache[actressName] = secureUrl;
                    imgElement.src = secureUrl;
                } else {
                    imgElement.src = "https://placehold.co/400x500?text=No+Image";
                }

                if (linkContainerElement && info.listURL?.digital) {
                    const btn = linkContainerElement.querySelector('.btn-link');
                    if (btn) btn.href = info.listURL.digital;
                }
            } else {
                imgElement.src = "https://placehold.co/400x500?text=Not+Found";
            }
        } catch (err) {
            console.error("Fetch error:", err);
            imgElement.src = "https://placehold.co/400x500?text=Error";
        }
    }

    // --- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° & ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ ---
    const resultsContainer = document.getElementById('resultsContainer');
    const countDisplay = document.getElementById('countDisplay');
    const genreContainer = document.getElementById('genreContainer');

    const allGenres = [...new Set(actressData.flatMap(d => d.genre))].sort();
    allGenres.forEach(g => {
        const lb = document.createElement('label');
        lb.className = 'checkbox-label';
        lb.innerHTML = `<input type="checkbox" value="${g}" class="filter-genre"> ${g}`;
        genreContainer.appendChild(lb);
    });

    function filterAndRender() {
        const nameVal = document.getElementById('filterName').value.trim();
        const cupVal = document.getElementById('filterCup').value;
        const selectedGenres = Array.from(document.querySelectorAll('.filter-genre:checked')).map(c => c.value);

        const filtered = actressData.filter(item => {
            if (nameVal && !item.name.includes(nameVal)) return false;
            if (cupVal && item.cup !== cupVal) return false;
            if (selectedGenres.length > 0 && !selectedGenres.some(g => item.genre.includes(g))) return false;
            return true;
        });

        renderGrid(filtered);
    }

    function renderGrid(data) {
        resultsContainer.innerHTML = '';
        countDisplay.textContent = data.length;

        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            const searchUrl = `https://www.dmm.co.jp/digital/videoa/-/list/=/searchstr=${item.name.replace(/\s+/g,"")}`;
            const affLink = `https://al.dmm.co.jp/?lurl=${encodeURIComponent(searchUrl)}&af_id=${AFF_ID}`;

            card.innerHTML = `
                <a href="?id=${item.id}" style="text-decoration:none; color:inherit;">
                    <div class="card-image-wrapper">
                        <div class="cup-badge">${item.cup}</div>
                        <img src="https://placehold.co/400x500?text=Loading..." class="card-image" id="img-${item.id}">
                    </div>
                    <div class="card-content">
                        <h2 class="card-title">${item.name}</h2>
                        <div class="stats-grid">
                            <div>B:${item.bust}</div><div>W:${item.waist}</div>
                            <div>H:${item.hip}</div><div>T:${item.height}</div>
                        </div>
                        <div class="tag-container">${item.genre.map(g=>`<span class="tag">${g}</span>`).join('')}</div>
                    </div>
                </a>
                <div class="link-wrapper">
                    <a href="${affLink}" target="_blank" class="btn-link">ä½œå“ã‚’è¦‹ã‚‹</a>
                </div>
            `;
            resultsContainer.appendChild(card);
            fetchActressImage(item.name, card.querySelector(`#img-${item.id}`), card.querySelector('.link-wrapper'));
        });
    }

    // åˆæœŸèµ·å‹•ã¨ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
    document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', filterAndRender));
    window.toggleSearch = () => {
        const b = document.getElementById('searchBody');
        b.style.display = (b.style.display === 'none') ? 'grid' : 'none';
    };
    window.resetFilters = () => {
        document.querySelectorAll('input[type="text"], input[type="number"]').forEach(i => i.value = '');
        document.querySelectorAll('input[type="checkbox"]').forEach(i => i.checked = false);
        document.getElementById('filterCup').value = '';
        filterAndRender();
    };

    // è©³ç´°ãƒšãƒ¼ã‚¸å‡¦ç†
    const urlParams = new URLSearchParams(window.location.search);
    const detailId = urlParams.get('id');
    if (detailId) {
        const target = actressData.find(a => a.id == detailId);
        if (target) {
            document.getElementById('mainContainer').innerHTML = `
                <a href="./" class="back-btn">â† æˆ»ã‚‹</a>
                <div class="detail-view">
                    <div class="detail-flex">
                        <div class="detail-img">
                            <img src="https://placehold.co/400x500?text=Loading..." id="detail-img">
                        </div>
                        <div class="detail-info">
                            <h1>${target.name} (${target.age}æ­³)</h1>
                            <table class="detail-table">
                                <tr><th>ã‚¹ãƒªãƒ¼ã‚µã‚¤ã‚º</th><td>B${target.bust} W${target.waist} H${target.hip}</td></tr>
                                <tr><th>ã‚«ãƒƒãƒ— / èº«é•·</th><td>${target.cup}ã‚«ãƒƒãƒ— / ${target.height}cm</td></tr>
                            </table>
                            <div class="link-wrapper">
                                <a href="#" target="_blank" class="btn-link">å…¬å¼ä½œå“ä¸€è¦§ã¸</a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            fetchActressImage(target.name, document.getElementById('detail-img'), document.querySelector('.link-wrapper'));
        }
    } else {
        filterAndRender();
    }
</script>
</body>
</html>
